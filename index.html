<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>App DrinkDrips</title>
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Honk&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Nanum+Gothic+Coding&display=swap" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <link rel="stylesheet" href="style.css">
    <link rel="stylesheet" href="custom-styles.css">
    <script defer src="script.js"></script>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/web3/dist/web3.min.js"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>
<body>
    <header>
        <div class="container">
            <div class="header-content">
                <h1>DrinkApp</h1>
                <button class="connect-button">
                    <i class="fas fa-wallet"></i> Conectar a MetaMask
                </button>
            </div>
        </div>
    </header>

    <div class="container">
        <div class="myHero"></div>  
        <div class="header text-center my-4">
            <nav>
                <ul>
                    <li><a href="https://drinkdrips.github.io/">Home</a></li>
                    <li><a href="#drink-info">Sobre</a></li>
                    <li><a href="#tokenomics">Tokenomics</a></li>
                    <li><a href="#roadmap">Roadmap</a></li>
                </ul>
            </nav>
            <h1>Bem-vindos ao App DrinkDrips</h1>
            <p class="nanum-gothic-coding-regular">Drink é o principal utility token da DrinkDrips, aqui você poderá comprar seus tokens, colocar em stake para coletar Drips, fazer unstake e consultar informações.</p>
        </div>

        <!-- Adicionando títulos e textos antes dos conjuntos de cards -->
        <div class="text-center my-4">
            <h2>Gestão de Tokens</h2>
            <p class="nanum-gothic-coding-regular">Aqui você pode comprar tokens Drink usando ETH ou USDT.</p>
        </div>
      
       <div class="container my-4">
        <div class="row">
            <div class="col-md-6 mb-4">
                <div class="card">
                    <div class="card-body">
                        <h2 class="card-title">Comprar DRINK com ETH</h2>
                        <form id="buyDrinksEthForm">
                            <div class="form-group">
                                <label for="ethAmount">Quantidade de ETH:</label>
                                <input type="number" class="form-control" id="ethAmount" placeholder="0.1" step="0.01" min="0">
                            </div>
                            <button type="submit" class="btn btn-primary btn-block">Comprar DRINK</button>
                        </form>
                    </div>
                </div>
            </div>

            <div class="col-md-6 mb-4">
                <div class="card">
                    <div class="card-body">
                        <h2 class="card-title">Comprar DRINK com USDT</h2>
                        <form id="buyDrinksUsdtForm">
                            <div class="form-group">
                                <label for="usdtAmount">Quantidade de USDT:</label>
                                <input type="number" class="form-control" id="usdtAmount" placeholder="10" step="1" min="0">
                            </div>
                            <button type="submit" class="btn btn-primary btn-block">Comprar DRINK</button>
                        </form>
                    </div>
                </div>
            </div>

            <div class="col-md-6 mb-4">
                <div class="card">
                    <div class="card-body">
                        <h2 class="card-title">Aprovar DRINK para Staking</h2>
                        <form id="approveDrinksForm">
                            <div class="form-group">
                                <label for="approveAmount">Quantidade de DRINK:</label>
                                <input type="number" class="form-control" id="approveAmount" placeholder="10" step="1" min="0">
                            </div>
                            <button type="submit" class="btn btn-secondary btn-block">Aprovar</button>
                        </form>
                    </div>
                </div>
            </div>

            <div class="col-md-6 mb-4">
                <div class="card">
                    <div class="card-body">
                        <h2 class="card-title">Fazer Stake de DRINK</h2>
                        <form id="stakeDrinksForm">
                            <div class="form-group">
                                <label for="stakeAmount">Quantidade de DRINK:</label>
                                <input type="number" class="form-control" id="stakeAmount" placeholder="10" step="1" min="0">
                            </div>
                            <button type="submit" class="btn btn-success btn-block">Stake</button>
                        </form>
                    </div>
                </div>
            </div>

            <div class="col-md-6 mb-4">
                <div class="card">
                    <div class="card-body">
                        <h2 class="card-title">Fazer Unstake de DRINK</h2>
                        <form id="unstakeDrinksForm">
                            <div class="form-group">
                                <label for="unstakeAmount">Quantidade de DRINK:</label>
                                <input type="number" class="form-control" id="unstakeAmount" placeholder="10" step="1" min="0">
                            </div>
                            <button type="submit" class="btn btn-danger btn-block">Unstake</button>
                        </form>
                    </div>
                </div>
            </div>

            <div class="col-md-6 mb-4">
                <div class="card">
                    <div class="card-body">
                        <h2 class="card-title">Saldos</h2>
                        <button class="btn btn-success btn-block mb-4" id="refreshBalancesBtn">Atualizar Saldos</button>
                        <p>Saldo de DRINK: <span id="drinkBalance">Loading...</span> DRINK</p>
                        <p>Saldo de DRIPS: <span id="dripsBalance">Loading...</span> DRIPS</p>
                    </div>
                </div>
            </div>
        </div>

        <!-- Seção adicional -->
        <div class="text-center my-4">
            <h2>Informações Adicionais</h2>
            <p class="nanum-gothic-coding-regular">Veja abaixo informações adicionais sobre o token DRINK.</p>
        </div>
        <div class="row">
            <!-- Gráfico ou qualquer outra informação adicional -->
            <div class="col-md-12 mb-4">
                <div class="card h-100">
                    <div class="card-body">
                        <h2 class="card-title">Gráfico de Preço</h2>
                        <canvas id="priceChart"></canvas>
                    </div>
                </div>
            </div>
        </div>
    </div>

<footer class="mt-5">
    <div class="container">
        <div class="row">
            <div class="col-md-4 logoRodape">
                <img src="https://lh3.googleusercontent.com/pw/AP1GczPYBu_sgsFmmj8AIRKOG6ZL06yEPdLaZ5c4iuo_XmFmuaf1Ya5VkyS0_gnvisgQUSfSBOh24UEsHm30UMLQgQoDo83OkeDl3Y2FpdHRgmzOJWjvDIhRLvHIkxTiStfKCaTFyKoetP7PLCtw_8GeBA=w1648-h927-s-no-gm?authuser=1" alt="DrinkDrips" alt="Logo">
            </div>
            <div class="col-md-4">
                <p>&copy; <span id="year"></span> DrinkDrips. Todos os direitos reservados.</p>
            </div>
            <div class="col-md-4">
                <ul class="list-inline">
                    <li class="list-inline-item"><a href="#">Termos de Serviço</a></li>
                    <li class="list-inline-item"><a href="#">Política de Privacidade</a></li>
                    <li class="list-inline-item"><a href="#">Contato</a></li>
                </ul>
            </div>
        </div>
    </div>
</footer>

  <script>
    // Atualiza o ano automaticamente
    document.addEventListener('DOMContentLoaded', function() {
        const currentYear = new Date().getFullYear();
        document.getElementById('year').textContent = currentYear;
    });</script>
    <!-- JavaScript -->
    <script>
        async function connectWallet() {
            if (window.ethereum) {
                try {
                    const accounts = await ethereum.request({ method: 'eth_requestAccounts' });
                    const account = accounts[0];
                    document.querySelector('.connect-button').innerText = `Conectado: ${account}`;
                    return account;
                } catch (error) {
                    console.error("Erro ao conectar à MetaMask", error);
                }
            } else {
                alert("MetaMask não encontrada. Por favor, instale a MetaMask.");
            }
        }

// Event listener para o formulário de aprovação
        document.getElementById('approveDrinksForm').addEventListener('submit', async (event) => {
            event.preventDefault();
            const approveAmount = document.getElementById('approveAmount').value;
            const account = await connectWallet();
            try {
                // Chama a função de aprovação do contrato
                await drinkToken.methods.approve(stakingContractAddress, web3.utils.toWei(approveAmount, 'ether')).send({ from: account });
                alert('Aprovação bem-sucedida!');
            } catch (error) {
                console.error("Erro ao aprovar tokens", error);
                alert('Erro ao aprovar tokens.');
            }
        });
      
        const drinkTokenAddress = '0xSeuEnderecoDoContratoDrinkToken';
        const dripsTokenAddress = '0xSeuEnderecoDoContratoDripsToken';
        const stakingContractAddress = '0xSeuEnderecoDoContratoStaking';

        const drinkTokenABI = [/* ABI do contrato DrinkToken */];
        const dripsTokenABI = [/* ABI do contrato DripsToken */];
        const stakingContractABI = [/* ABI do contrato StakingContract */];

        const web3 = new Web3(Web3.givenProvider);
        const drinkToken = new web3.eth.Contract(drinkTokenABI, drinkTokenAddress);
        const dripsToken = new web3.eth.Contract(dripsTokenABI, dripsTokenAddress);
        const stakingContract = new web3.eth.Contract(stakingContractABI, stakingContractAddress);

        async function buyDrinksWithEth() {
            const account = await connectWallet();
            const ethAmount = document.getElementById('ethAmount').value;
            const ethValue = web3.utils.toWei(ethAmount, 'ether');

            try {
                await drinkToken.methods.buyTokensWithEther().send({ from: account, value: ethValue });
                alert('Compra realizada com sucesso!');
                await getBalances();
            } catch (error) {
                console.error("Erro ao comprar tokens com ETH", error);
            }
        }

        async function buyDrinksWithUsdt() {
            const account = await connectWallet();
            const usdtAmount = document.getElementById('usdtAmount').value;

            try {
                await drinkToken.methods.buyTokensWithUsdt(usdtAmount).send({ from: account });
                alert('Compra realizada com sucesso!');
                await getBalances();
            } catch (error) {
                console.error("Erro ao comprar tokens com USDT", error);
            }
        }

        async function stakeDrinks() {
            const account = await connectWallet();
            const stakeAmount = document.getElementById('stakeAmount').value;

            try {
                await stakingContract.methods.stakeTokens(stakeAmount).send({ from: account });
                alert('Stake realizado com sucesso!');
                await getBalances();
            } catch (error) {
                console.error("Erro ao fazer stake de tokens", error);
            }
        }

        async function unstakeDrinks() {
            const account = await connectWallet();
            const unstakeAmount = document.getElementById('unstakeAmount').value;

            try {
                await stakingContract.methods.unstakeTokens(unstakeAmount).send({ from: account });
                alert('Unstake realizado com sucesso!');
                await getBalances();
            } catch (error) {
                console.error("Erro ao fazer unstake de tokens", error);
            }
        }

        async function getBalances() {
            const account = await connectWallet();

            try {
                const drinkBalance = await drinkToken.methods.balanceOf(account).call();
                const stakedBalance = await stakingContract.methods.stakingBalance(account).call();
                const dripsBalance = await dripsToken.methods.balanceOf(account).call();

                document.getElementById('walletBalance').textContent = web3.utils.fromWei(drinkBalance, 'ether');
                document.getElementById('stakedBalance').textContent = web3.utils.fromWei(stakedBalance, 'ether');
                document.getElementById('drinkBalance').textContent = web3.utils.fromWei(drinkBalance, 'ether');
                document.getElementById('dripsBalance').textContent = web3.utils.fromWei(dripsBalance, 'ether');
            } catch (error) {
                console.error("Erro ao obter saldos", error);
            }
        }

        document.addEventListener('DOMContentLoaded', () => {
            document.querySelector('.connect-button').addEventListener('click', connectWallet);
            document.getElementById('buyDrinksEthForm').addEventListener('submit', async (e) => {
                e.preventDefault();
                await buyDrinksWithEth();
            });

            document.getElementById('buyDrinksUsdtForm').addEventListener('submit', async (e) => {
                e.preventDefault();
                await buyDrinksWithUsdt();
            });

            document.getElementById('stakeDrinksForm').addEventListener('submit', async (e) => {
                e.preventDefault();
                await stakeDrinks();
            });

            document.getElementById('unstakeDrinksForm').addEventListener('submit', async (e) => {
                e.preventDefault();
                await unstakeDrinks();
            });

            document.getElementById('refreshBalancesBtn').addEventListener('click', getBalances);

            // Chamada inicial para obter saldos
            getBalances();
        });

        // Gráfico de Preço
        const ctx = document.getElementById('priceChart').getContext('2d');
        const priceChart = new Chart(ctx, {
            type: 'line',
            data: {
                labels: ['Janeiro', 'Fevereiro', 'Março', 'Abril', 'Maio', 'Junho'],
                datasets: [{
                    label: 'Preço DRINK',
                    data: [0.08, 0.09, 0.10, 0.11, 0.12, 0.13],
                    backgroundColor: 'rgba(75, 192, 192, 0.2)',
                    borderColor: 'rgba(75, 192, 192, 1)',
                    borderWidth: 1
                }]
            },
            options: {
                scales: {
                    y: {
                        beginAtZero: true
                    }
                }
            }
        });
    </script>
  <div class="alert" id="transactionAlert" style="display: none;"></div>
    <script>
        // Função para exibir alertas
        function showAlert(message, type) {
            const alertDiv = document.getElementById('transactionAlert');
            alertDiv.innerHTML = `<div class="alert alert-${type}" role="alert">${message}</div>`;
            alertDiv.style.display = 'block';
            setTimeout(() => {
                alertDiv.style.display = 'none';
            }, 5000); // Oculta o alerta após 5 segundos
        }

        // Exemplo de uso:
        // showAlert('Transação bem-sucedida!', 'success');
        // showAlert('Erro ao conectar à MetaMask', 'danger');
    </script>
</body>
</html>
